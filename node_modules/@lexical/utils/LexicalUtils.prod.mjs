/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 */

import{isHTMLElement as t,$getSelection as e,$isRangeSelection as n,$isElementNode as o,getDOMTextNode as r,$getRoot as l,$cloneWithProperties as i,$setSelection as u,$getPreviousSelection as s,$isRootOrShadowRoot as c,$isTextNode as f,$splitNode as d,$createParagraphNode as a}from"lexical";export{$splitNode,isBlockDomNode,isHTMLAnchorElement,isHTMLElement,isInlineDomNode}from"lexical";import{createRectsFromDOMRange as g}from"@lexical/selection";function p(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var h=p((function(t){const e=new URLSearchParams;e.append("code",t);for(let t=1;t<arguments.length;t++)e.append("v",arguments[t]);throw Error(`Minified Lexical error #${t}; visit https://lexical.dev/docs/error?${e} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}));const m="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement,v=m&&"documentMode"in document?document.documentMode:null,y=m&&/Mac|iPod|iPhone|iPad/.test(navigator.platform),w=m&&/^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent),S=!(!m||!("InputEvent"in window)||v)&&"getTargetRanges"in new window.InputEvent("input"),E=m&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),b=m&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,x=m&&/Android/.test(navigator.userAgent),P=m&&/^(?=.*Chrome).*/i.test(navigator.userAgent),C=m&&x&&P,L=m&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&!P;function A(...t){const e=[];for(const n of t)if(n&&"string"==typeof n)for(const[t]of n.matchAll(/\S+/g))e.push(t);return e}function N(...t){return()=>{for(let e=t.length-1;e>=0;e--)t[e]();t.length=0}}function T(t){return`${t}px`}const B={attributes:!0,characterData:!0,childList:!0,subtree:!0};function M(e,n,o){let r=null,l=null,i=null,u=[];const s=document.createElement("div");function c(){null===r&&h(182),null===l&&h(183);const{left:t,top:i}=l.getBoundingClientRect(),c=g(e,n);var f,d;s.isConnected||(d=s,(f=l).insertBefore(d,f.firstChild));let a=!1;for(let e=0;e<c.length;e++){const n=c[e],o=u[e]||document.createElement("div"),r=o.style;"absolute"!==r.position&&(r.position="absolute",a=!0);const l=T(n.left-t);r.left!==l&&(r.left=l,a=!0);const f=T(n.top-i);r.top!==f&&(o.style.top=f,a=!0);const d=T(n.width);r.width!==d&&(o.style.width=d,a=!0);const g=T(n.height);r.height!==g&&(o.style.height=g,a=!0),o.parentNode!==s&&(s.append(o),a=!0),u[e]=o}for(;u.length>c.length;)u.pop();a&&o(u)}function f(){l=null,r=null,null!==i&&i.disconnect(),i=null,s.remove();for(const t of u)t.remove();u=[]}s.style.position="relative";const d=e.registerRootListener((function n(){const o=e.getRootElement();if(null===o)return f();const u=o.parentElement;if(!t(u))return f();f(),r=o,l=u,i=new MutationObserver((t=>{const o=e.getRootElement(),i=o&&o.parentElement;if(o!==r||i!==l)return n();for(const e of t)if(!s.contains(e.target))return c()})),i.observe(u,B),c()}));return()=>{d(),f()}}function R(t,e,n){if("text"!==t.type&&o(e)){const o=e.getDOMSlot(n);return[o.element,o.getFirstChildOffset()+t.offset]}return[r(n)||n,t.offset]}function _(t,o){let r=null,l=null,i=null,u=null,s=null,c=null,f=()=>{};function d(d){d.read((()=>{const d=e();if(!n(d))return r=null,i=null,u=null,c=null,f(),void(f=()=>{});const{anchor:a,focus:g}=d,p=a.getNode(),h=p.getKey(),m=a.offset,v=g.getNode(),y=v.getKey(),w=g.offset,S=t.getElementByKey(h),E=t.getElementByKey(y),b=null===r||S!==l||m!==i||h!==r.getKey(),x=null===u||E!==s||w!==c||y!==u.getKey();if((b||x)&&null!==S&&null!==E){const e=function(t,e,n,o,r,l,i){const u=(t._window?t._window.document:document).createRange();return l.isBefore(n)?(u.setStart(...R(r,l,i)),u.setEnd(...R(e,n,o))):(u.setStart(...R(e,n,o)),u.setEnd(...R(r,l,i))),u}(t,a,p,S,g,v,E);f(),f=M(t,e,(t=>{if(void 0===o)for(const e of t){const t=e.style;"Highlight"!==t.background&&(t.background="Highlight"),"HighlightText"!==t.color&&(t.color="HighlightText"),t.marginTop!==T(-1.5)&&(t.marginTop=T(-1.5)),t.paddingTop!==T(4)&&(t.paddingTop=T(4)),t.paddingBottom!==T(0)&&(t.paddingBottom=T(0))}else o(t)}))}r=p,l=S,i=m,u=v,s=E,c=w}))}return d(t.getEditorState()),N(t.registerUpdateListener((({editorState:t})=>d(t))),(()=>{f()}))}function O(t){let e=null;const n=()=>{const n=getSelection(),o=n&&n.anchorNode,r=t.getRootElement();null!==o&&null!==r&&r.contains(o)?null!==e&&(e(),e=null):null===e&&(e=_(t))};return document.addEventListener("selectionchange",n),()=>{null!==e&&e(),document.removeEventListener("selectionchange",n)}}const K=S,z=m,F=x,H=C,I=y,k=L,D=P,$=w,U=b,W=E;function j(t,...e){const n=A(...e);n.length>0&&t.classList.add(...n)}function V(t,...e){const n=A(...e);n.length>0&&t.classList.remove(...n)}function q(t,e){for(const n of e)if(t.type.startsWith(n))return!0;return!1}function G(t,e){const n=t[Symbol.iterator]();return new Promise(((t,o)=>{const r=[],l=()=>{const{done:i,value:u}=n.next();if(i)return t(r);const s=new FileReader;s.addEventListener("error",o),s.addEventListener("load",(()=>{const t=s.result;"string"==typeof t&&r.push({file:u,result:t}),l()})),q(u,e)?s.readAsDataURL(u):l()};l()}))}function J(t,e){return Array.from(Z(t,e))}function Q(t,e){return Array.from(ot(t,e))}const X={done:!0,value:void 0},Y=t=>({done:!1,value:t});function Z(t,e){const n=(t||l()).getLatest(),r=et(n),i=e;let u=n,s=r,c=!0;const f={next(){if(null===u)return X;if(c)return c=!1,Y({depth:s,node:u});if(u===i)return X;if(o(u)&&u.getChildrenSize()>0)u=u.getFirstChild(),s++;else{let t;[u,t]=tt(u)||[null,0],s+=t,null==i&&s<=r&&(u=null)}return null===u?X:Y({depth:s,node:u})},[Symbol.iterator]:()=>f};return f}function tt(t){let e=t,n=null,o=0;for(;null===n&&null!==e;)n=e.getNextSibling(),null===n?(e=e.getParent(),o--):e=n;return null===e?null:[e,o]}function et(t){let e=t,n=0;for(;null!==(e=e.getParent());)n++;return n}function nt(t){let e=t;if(o(e)&&e.getChildrenSize()>0)e=e.getLastChild();else{let t=null;for(;null===t&&null!==e;)t=e.getPreviousSibling(),e=null===t?e.getParent():t}return e}function ot(t,e){const n=(t||l()).getLatest(),r=et(n),i=e;let u=n,s=r,c=!0;const f={next(){if(null===u)return X;if(c)return c=!1,Y({depth:s,node:u});if(u===i)return X;if(o(u)&&u.getChildrenSize()>0)u=u.getLastChild(),s++;else{let t;[u,t]=function(t){let e=t,n=null,o=0;for(;null===n&&null!==e;)n=e.getPreviousSibling(),null===n?(e=e.getParent(),o--):e=n;return null===e?null:[e,o]}(u)||[null,0],s+=t,null==i&&s<=r&&(u=null)}return null===u?X:Y({depth:s,node:u})},[Symbol.iterator]:()=>f};return f}function rt(t,e){let n=t;for(;null!=n;){if(n instanceof e)return n;n=n.getParent()}return null}function lt(t){const e=it(t,(t=>o(t)&&!t.isInline()));return o(e)||h(4,t.__key),e}const it=(t,e)=>{let n=t;for(;n!==l()&&null!=n;){if(e(n))return n;n=n.getParent()}return null};function ut(t,e,n,o){const r=t=>t instanceof e;return t.registerNodeTransform(e,(t=>{const e=(t=>{const e=t.getChildren();for(let t=0;t<e.length;t++){const n=e[t];if(r(n))return null}let n=t,o=t;for(;null!==n;)if(o=n,n=n.getParent(),r(n))return{child:o,parent:n};return null})(t);if(null!==e){const{child:r,parent:l}=e;if(r.is(t)){o(l,t);const e=r.getNextSiblings(),i=e.length;if(l.insertAfter(r),0!==i){const t=n(l);r.insertAfter(t);for(let n=0;n<i;n++)t.append(e[n])}l.canBeEmpty()||0!==l.getChildrenSize()||l.remove()}}}))}function st(t,e){const n=new Map,o=t._pendingEditorState;for(const[t,o]of e._nodeMap)n.set(t,i(o));o&&(o._nodeMap=n),t._dirtyType=2;const r=e._selection;u(null===r?null:r.clone())}function ct(t){const o=e()||s();if(n(o)){const{focus:e}=o,n=e.getNode(),r=e.offset;if(c(n)){const e=n.getChildAtIndex(r);null==e?n.append(t):e.insertBefore(t),t.selectNext()}else{let e,o;f(n)?(e=n.getParentOrThrow(),o=n.getIndexWithinParent(),r>0&&(o+=1,n.splitText(r))):(e=n,o=r);const[,l]=d(e,o);l.insertBefore(t),l.selectStart()}}else{if(null!=o){const e=o.getNodes();e[e.length-1].getTopLevelElementOrThrow().insertAfter(t)}else{l().append(t)}const e=a();t.insertAfter(e),e.select()}return t.getLatest()}function ft(t,e){const n=e();return t.replace(n),n.append(t),n}function dt(t,e){return null!==t&&Object.getPrototypeOf(t).constructor.name===e.name}function at(t,e){const n=[];for(let o=0;o<t.length;o++){const r=e(t[o]);null!==r&&n.push(r)}return n}function gt(t,e){const n=t.getFirstChild();null!==n?n.insertBefore(e):t.append(e)}let pt=!($||!z)&&void 0;function ht(t){let e=1;if(function(){if(void 0===pt){const t=document.createElement("div");t.style.cssText="position: absolute; opacity: 0; width: 100px; left: -1000px;",document.body.appendChild(t);const e=t.getBoundingClientRect();t.style.setProperty("zoom","2"),pt=t.getBoundingClientRect().width===e.width,document.body.removeChild(t)}return pt}())for(;t;)e*=Number(window.getComputedStyle(t).getPropertyValue("zoom")),t=t.parentElement;return e}function mt(t){return null!==t._parentEditor}function vt(t,e){return yt(t,e,null)}function yt(t,e,n){let r=!1;for(const l of Et(t))e(l)?null!==n&&n(l):(r=!0,o(l)&&yt(l,e,n||(t=>l.insertAfter(t))),l.remove());return r}function wt(t,e){const n=[],r=[...t].reverse();for(let t=r.pop();void 0!==t;t=r.pop())if(e(t))n.push(t);else if(o(t))for(const e of Et(t))r.push(e);return n}function St(t){return{[Symbol.iterator]:()=>bt(t.getFirstChild(),(t=>t.getNextSibling()))}}function Et(t){return{[Symbol.iterator]:()=>bt(t.getLastChild(),(t=>t.getPreviousSibling()))}}function bt(t,e){let n=t;return{next(){if(null===n)return X;const t=Y(n);return n=e(n),t}}}function xt(t){for(const e of St(t))t.insertBefore(e);t.remove()}export{wt as $descendantsMatching,J as $dfs,Z as $dfsIterator,at as $filter,it as $findMatchingParent,St as $firstToLastIterator,et as $getDepth,lt as $getNearestBlockElementAncestorOrThrow,rt as $getNearestNodeOfType,nt as $getNextRightPreorderNode,tt as $getNextSiblingOrParentSibling,gt as $insertFirst,ct as $insertNodeToNearestRoot,mt as $isEditorIsNestedEditor,Et as $lastToFirstIterator,st as $restoreEditorState,Q as $reverseDfs,ot as $reverseDfsIterator,vt as $unwrapAndFilterDescendants,xt as $unwrapNode,ft as $wrapNodeInElement,K as CAN_USE_BEFORE_INPUT,z as CAN_USE_DOM,F as IS_ANDROID,H as IS_ANDROID_CHROME,I as IS_APPLE,k as IS_APPLE_WEBKIT,D as IS_CHROME,$ as IS_FIREFOX,U as IS_IOS,W as IS_SAFARI,j as addClassNamesToElement,ht as calculateZoomLevel,q as isMimeType,_ as markSelection,G as mediaFileReader,N as mergeRegister,dt as objectKlassEquals,M as positionNodeOnRange,ut as registerNestedElementResolver,V as removeClassNamesFromElement,O as selectionAlwaysOnDisplay};
