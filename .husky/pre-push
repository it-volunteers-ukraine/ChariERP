#!/bin/sh
echo "ğŸ” Detecting changes in push..."

# Check what's being pushed (more comprehensive than staged files)
CLIENT_CHANGED=$(git diff origin/main...HEAD --name-only | grep -E "^client/" || true)
SERVER_CHANGED=$(git diff origin/main...HEAD --name-only | grep -E "^server/" || true)

if [ -n "$CLIENT_CHANGED" ]; then
    echo "ğŸš€ Client changes detected, running client pre-push checks..."
    cd client
    echo "ğŸ“ Type checking client..."
    npm run compile
    echo "ğŸ§ª Testing client..."
    npm run test
    cd ..
fi

if [ -n "$SERVER_CHANGED" ]; then
    echo "ğŸš€ Server changes detected, running server pre-push checks..."
    cd server
    echo "ğŸ“ Type checking server..."
    npm run type-check
    echo "ğŸ” Linting server..."
    npm run lint
    echo "ğŸ§ª Testing server..."
    npm run test
    cd ..
fi

echo "âœ… All applicable checks passed!"
