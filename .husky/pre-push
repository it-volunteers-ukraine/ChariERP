#!/bin/sh
echo "ğŸ” Detecting changes in push..."

CHANGED_FILES=$(git diff origin/main...HEAD --name-only)

if echo "$CHANGED_FILES" | grep -qE "^client/"; then
    echo "ğŸš€ Client changes detected, running pre-push checks..."
    echo "ğŸ“ Type checking client..."
    npm run compile --workspace client
    echo "ğŸ§ª Testing client..."
    npm run test --workspace client
fi

if echo "$CHANGED_FILES" | grep -qE "^server/"; then
    echo "ğŸš€ Server changes detected, running pre-push checks..."
    echo "ğŸ“ Type checking server..."
    npm run type-check --workspace server
    echo "ğŸ” Linting server..."
    npm run lint --workspace server
    echo "ğŸ§ª Testing server..."
    npm run test --workspace server
fi

echo "âœ… All applicable pre-push checks passed!"
